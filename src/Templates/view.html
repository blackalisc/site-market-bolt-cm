{% extends "layout.html" %}


{% block header_title %} | {{package.title}}{% endblock %}

{% block content %}
<div class="ui grid stackable">
    <div class="eight wide column">     
        <h2 class="ui header">
            <img class="ui rounded image" src="/images/{{ package.type }}">
            <div class="content">
                {{package.title}}
                <div class="sub header">by {{package.authors}}</div>
            </div>
        </h2>
        <!-- <div>Last Update: 13/08/2015</div> -->
    </div>
    <div class="right floated right aligned six wide column">

        <div class="buttons_header">
            <button class="ui toggle button" id="copy-button" data-content="{{ package.name }}" data-title="Click to copy the package name" data-clipboard-text="{{ package.name }}"><i class="alternate copy icon"></i> Copy to clipboard</button>
            <button class="ui green button">FREE</button>
            </div>

            <div class="ui right floated main menu">
                <a class="bug popup icon item" data-content="Downloads" href="#">
                    <i class="download icon"> {{package.downloads|default(0)}}</i>
                </a>

                <a class="bug popup icon item" data-content="Stars" href="#">
                    <i class="star icon"> {{package.stars|default(0)}}</i>
                </a>

                <a class="github popup icon item" data-content="View source code" target="_blank" href="{{package.source}}">
                    {% if "github.com" in package.source %} 
                        <i class="alternate github icon"></i> 
                    {% else %} 
                        <i class="alternate link icon"></i> 
                    {% endif %}
                </a>
        </div>
    </div>
</div>

<br>


{% if package.screenshots %}

<h2 class="ui left floated header">Screenshots</h2>
<div class="ui clearing divider"></div>
<div class="slide_gallery scrollbar-inner">
    <div class="gallery" id="scroll_gallery">
        {% for image in package.screenshots%}
        {% if "//" in image %}
        <img class="image_gallery" src="{{image}}">                    
        {% else %} 
        <img class="image_gallery" src="{{package.source|replace({ ('github.com'): 'raw.githubusercontent.com'})}}/master/{{image}}">
        {% endif %}
        {% endfor %}
    </div>

</div>

<script type="text/javascript">
    jQuery(document).ready(function(){
        jQuery('.scrollbar-inner').scrollbar();
    });
</script>

<br>

{% endif %}

<div class="ui grid stackable">


    <div class="ten wide column">
        <h2 class="ui left floated header">Description</h2>
        <div class="ui clearing divider"></div>
        <p style="font-size: 110%;">{{package.description}}</p>

        {# {{ dump(package) }} #}

    </div>


    <div class="six wide column">
        <h2 class="ui left floated header">More Info</h2>
        <div class="ui clearing divider"></div>

        <div class="ui relaxed large divided list">
            <div class="item">
                <i class="large file code outline middle aligned icon"></i>
                <div class="content">
                    <a class="header">Created</a>
                    <div class="description">{{package.created.date|date('jS M Y')}}</div>
                </div>
            </div>
            <div class="item">
                <i class="large flag outline middle aligned icon"></i>
                <div class="content">
                    <a class="header">Latest Version</a>
                    <div class="description">{{package.versions[0]}}</div>
                </div>
            </div>
            <div class="item">
                <i class="large history middle aligned icon"></i>
                <div class="content">
                    <a class="header">Last Update</a>
                    <div class="description">{{package.updated.date|date('jS M Y')}}</div>
                </div>
            </div>
            <div class="item">
                <i class="large folder outline middle aligned icon"></i>
                <div class="content">
                    <a class="header">Category</a>
                    <div class="description">
                        {% if "bolt-extension" == package.type %}
                        Plugin
                        {% else %}
                        Theme
                        {% endif %}
                    </div>
                </div>
            </div>
            <div class="item">
                <i class="large tags middle aligned icon"></i>
                <div class="content">
                    <a class="header">Tags</a>
                    <div class="description">
                        {% for tag in package.keywords %}
                        <a href="{{url('browse')}}?q={{tag}}"><span class="label tags">{{tag}}</span></a>
                        {% endfor %}
                    </div>
                </div>
            </div>
        </div>
    </div>

    <br>


    {% if "github.com" in package.source %}

    <div class="sixteen wide column">
        <h2 class="ui left floated header">Changelog & Releases</h2>
        <div class="ui clearing divider"></div>
        

        <div class="ui accordion styled fluid gbody">
        </div>

        <script type="text/javascript">
            var repo_name = "{{ package.source }}";
            var repo_name = repo_name.replace('https://github.com/', '');

            console.log( repo_name );

            $.getJSON( "https://api.github.com/repos/" + repo_name + "/releases?username=mikescops&access_token=43a8a0150fb7da81a7aa8205caa8e609b606a7eb", function( json ) {
//          console.log( "JSON Data: " + json[0].body );

$.each( json, function (i){
    var gbody = json[i].body;
    var gversion = json[i].tag_name;
    if( !$.trim(gbody).length ){
        var gbody = "No description for this version of the extension.";
    }

    $( '<div class="title"><i class="dropdown icon"></i>' + gversion + '</div> <div class="content"><pre>' + gbody + '</pre></div>').appendTo( '.gbody' );
})



});

            $('.ui.accordion')
            .accordion()
            ;
        </script>
    </div>

    {% endif %}
    <br>


    <div class="ten wide column">
        <h2 class="ui left floated header">Comments</h2>
        <div class="ui clearing divider"></div>
        <div class="disqus_comments">
            <div id="disqus_thread"></div>
            <script type="text/javascript">
                /* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
            var disqus_shortname = 'boltcm'; // Required - Replace '<example>' with your forum shortname

            /* * * DON'T EDIT BELOW THIS LINE * * */
            (function() {
                var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
                dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
                (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
            })();</script>
            <noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
        </div>
    </div>

    <div class="six wide column">
        <h2 class="ui left floated header">Related</h2>
        <div class="ui clearing divider"></div>

        <div class="ui relaxed large divided vertical list related_list">
            {% for related in package.account.packages |slice(0, 7) %}
            {% if related != package %}
            <div class="item">
                <img class="ui avatar image" src="/images/{{ related.type }}">
                <div class="content">
                    <a class="header" href="{{url('view',{'package':related.id})}}">{{related.title}}</a>
                    {{related.name}}
                </div>
            </div>
            {% endif %}
            {% endfor %}
        </div>
    </div>

</div>


{% endblock %}

{% block header_extra_scripts %}
<script src="/js/jquery.scrollbar.min.js"></script>
<script src="//cdn.jsdelivr.net/zeroclipboard/2.2.0/ZeroClipboard.min.js"></script>
<script src="/js/extension-extras.js"></script>
{% endblock %}